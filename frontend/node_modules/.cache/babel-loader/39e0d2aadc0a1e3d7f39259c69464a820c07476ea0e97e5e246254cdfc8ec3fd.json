{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\LENOVO\\\\Downloads\\\\attendance-system-qr\\\\frontend\\\\src\\\\pages\\\\QRScanner.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect } from 'react';\nimport { Html5Qrcode } from 'html5-qrcode';\nimport axios from 'axios';\nimport { generateDeviceFingerprint } from '../utils/deviceFingerprint';\nimport { API_BASE } from '../config';\nimport './QRScanner.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function QRScanner({\n  user\n}) {\n  _s();\n  useEffect(() => {\n    const startScanner = async () => {\n      // ✅ Ask Camera Permission\n      try {\n        await navigator.mediaDevices.getUserMedia({\n          video: true\n        });\n      } catch (err) {\n        alert(\"Camera permission is required. Please allow camera.\");\n        return;\n      }\n      const html5QrCode = new Html5Qrcode(\"reader\");\n      const config = {\n        fps: 10,\n        qrbox: {\n          width: 250,\n          height: 250\n        }\n      };\n      html5QrCode.start({\n        facingMode: \"environment\"\n      }, config, async decodedText => {\n        html5QrCode.stop(); // ✅ Stop scanner after scanning\n\n        const token = decodedText;\n        const device_fingerprint = generateDeviceFingerprint();\n\n        // ✅ Get Location\n        navigator.geolocation.getCurrentPosition(async pos => {\n          const {\n            latitude,\n            longitude\n          } = pos.coords;\n          try {\n            const res = await axios.post(`${API_BASE}/attendance-token`, {\n              student_id: user.student_id,\n              // ✅ Correct student id\n              token,\n              latitude,\n              longitude,\n              device_fingerprint\n            });\n            alert(res.data.message || \"Attendance Marked ✅\");\n          } catch (err) {\n            var _err$response, _err$response$data;\n            alert(\"Error: \" + (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.error) || err.message));\n          }\n        }, () => {\n          alert(\"Turn ON Location & try again.\");\n        });\n      });\n    };\n    startScanner();\n  }, [user]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"qr-scanner-container\",\n    style: {\n      textAlign: \"center\",\n      paddingTop: 20\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Scan QR Code\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Point your camera at the QR code shown by your teacher.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"reader\",\n      style: {\n        width: \"300px\",\n        margin: \"auto\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this);\n}\n_s(QRScanner, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n_c = QRScanner;\nvar _c;\n$RefreshReg$(_c, \"QRScanner\");","map":{"version":3,"names":["React","useEffect","Html5Qrcode","axios","generateDeviceFingerprint","API_BASE","jsxDEV","_jsxDEV","QRScanner","user","_s","startScanner","navigator","mediaDevices","getUserMedia","video","err","alert","html5QrCode","config","fps","qrbox","width","height","start","facingMode","decodedText","stop","token","device_fingerprint","geolocation","getCurrentPosition","pos","latitude","longitude","coords","res","post","student_id","data","message","_err$response","_err$response$data","response","error","className","style","textAlign","paddingTop","children","fileName","_jsxFileName","lineNumber","columnNumber","id","margin","_c","$RefreshReg$"],"sources":["C:/Users/LENOVO/Downloads/attendance-system-qr/frontend/src/pages/QRScanner.js"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { Html5Qrcode } from 'html5-qrcode';\r\nimport axios from 'axios';\r\nimport { generateDeviceFingerprint } from '../utils/deviceFingerprint';\r\nimport { API_BASE } from '../config';\r\nimport './QRScanner.css';\r\n\r\nexport default function QRScanner({ user }) {\r\n\r\n  useEffect(() => {\r\n    const startScanner = async () => {\r\n\r\n      // ✅ Ask Camera Permission\r\n      try {\r\n        await navigator.mediaDevices.getUserMedia({ video: true });\r\n      } catch (err) {\r\n        alert(\"Camera permission is required. Please allow camera.\");\r\n        return;\r\n      }\r\n\r\n      const html5QrCode = new Html5Qrcode(\"reader\");\r\n      const config = { fps: 10, qrbox: { width: 250, height: 250 } };\r\n\r\n      html5QrCode.start(\r\n        { facingMode: \"environment\" },\r\n        config,\r\n        async (decodedText) => {\r\n          html5QrCode.stop(); // ✅ Stop scanner after scanning\r\n\r\n          const token = decodedText;\r\n          const device_fingerprint = generateDeviceFingerprint();\r\n\r\n          // ✅ Get Location\r\n          navigator.geolocation.getCurrentPosition(async (pos) => {\r\n            const { latitude, longitude } = pos.coords;\r\n\r\n            try {\r\n              const res = await axios.post(`${API_BASE}/attendance-token`, {\r\n                student_id: user.student_id,            // ✅ Correct student id\r\n                token,\r\n                latitude,\r\n                longitude,\r\n                device_fingerprint\r\n              });\r\n\r\n              alert(res.data.message || \"Attendance Marked ✅\");\r\n\r\n            } catch (err) {\r\n              alert(\"Error: \" + (err.response?.data?.error || err.message));\r\n            }\r\n\r\n          }, () => {\r\n            alert(\"Turn ON Location & try again.\");\r\n          });\r\n\r\n        }\r\n      );\r\n    };\r\n\r\n    startScanner();\r\n  }, [user]);\r\n\r\n  return (\r\n    <div className=\"qr-scanner-container\" style={{ textAlign: \"center\", paddingTop: 20 }}>\r\n      <h2>Scan QR Code</h2>\r\n      <p>Point your camera at the QR code shown by your teacher.</p>\r\n      <div id=\"reader\" style={{ width: \"300px\", margin: \"auto\" }}></div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}