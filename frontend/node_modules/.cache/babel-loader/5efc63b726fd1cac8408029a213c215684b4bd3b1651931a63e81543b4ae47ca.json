{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\LENOVO\\\\Downloads\\\\attendance-system-qr\\\\frontend\\\\src\\\\pages\\\\QRScanner.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect } from 'react';\nimport { Html5Qrcode } from 'html5-qrcode';\nimport axios from 'axios';\nimport { generateDeviceFingerprint } from '../utils/deviceFingerprint';\nimport './QRScanner.css';\nimport { API_BASE } from '../config';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function QRScanner({\n  user\n}) {\n  _s();\n  useEffect(() => {\n    async function startScanner() {\n      // ✅ Request Camera Permission First\n      try {\n        await navigator.mediaDevices.getUserMedia({\n          video: true\n        });\n      } catch (err) {\n        alert(\"Camera permission is required. Please allow camera access.\");\n        return;\n      }\n      const scanner = new Html5Qrcode(\"reader\");\n      const config = {\n        fps: 10,\n        qrbox: {\n          width: 250,\n          height: 250\n        }\n      };\n      scanner.start({\n        facingMode: \"environment\"\n      }, config, async decodedText => {\n        const token = decodedText;\n        const device_fingerprint = generateDeviceFingerprint();\n\n        // ✅ GPS ACCESS\n        navigator.geolocation.getCurrentPosition(async pos => {\n          const {\n            latitude,\n            longitude\n          } = pos.coords;\n          try {\n            // ✅ FIXED: correct student_id + correct API URL\n            const res = await axios.post(`${API_BASE}/attendance-token`, {\n              student_id: user.student_id,\n              token,\n              latitude,\n              longitude,\n              device_fingerprint\n            });\n            alert(res.data.message || \"Attendance Marked ✅\");\n            scanner.stop();\n          } catch (err) {\n            var _err$response, _err$response$data;\n            alert(\"Error: \" + (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : (_err$response$data = _err$response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.error) || err.message));\n          }\n        }, () => {\n          alert(\"Turn on Location / GPS and try again.\");\n        });\n      });\n    }\n    startScanner();\n  }, [user]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"qr-scanner-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Scan QR Code\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Point your camera at the teacher's QR code.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"reader\",\n      style: {\n        width: \"300px\",\n        margin: \"auto\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 5\n  }, this);\n}\n_s(QRScanner, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n_c = QRScanner;\nvar _c;\n$RefreshReg$(_c, \"QRScanner\");","map":{"version":3,"names":["React","useEffect","Html5Qrcode","axios","generateDeviceFingerprint","API_BASE","jsxDEV","_jsxDEV","QRScanner","user","_s","startScanner","navigator","mediaDevices","getUserMedia","video","err","alert","scanner","config","fps","qrbox","width","height","start","facingMode","decodedText","token","device_fingerprint","geolocation","getCurrentPosition","pos","latitude","longitude","coords","res","post","student_id","data","message","stop","_err$response","_err$response$data","response","error","className","children","fileName","_jsxFileName","lineNumber","columnNumber","id","style","margin","_c","$RefreshReg$"],"sources":["C:/Users/LENOVO/Downloads/attendance-system-qr/frontend/src/pages/QRScanner.js"],"sourcesContent":["import React, { useEffect } from 'react';\r\nimport { Html5Qrcode } from 'html5-qrcode';\r\nimport axios from 'axios';\r\nimport { generateDeviceFingerprint } from '../utils/deviceFingerprint';\r\nimport './QRScanner.css';\r\nimport { API_BASE } from '../config';\r\n\r\nexport default function QRScanner({ user }) {\r\n\r\n  useEffect(() => {\r\n\r\n    async function startScanner() {\r\n      // ✅ Request Camera Permission First\r\n      try {\r\n        await navigator.mediaDevices.getUserMedia({ video: true });\r\n      } catch (err) {\r\n        alert(\"Camera permission is required. Please allow camera access.\");\r\n        return;\r\n      }\r\n\r\n      const scanner = new Html5Qrcode(\"reader\");\r\n      const config = { fps: 10, qrbox: { width: 250, height: 250 } };\r\n\r\n      scanner.start(\r\n        { facingMode: \"environment\" },\r\n        config,\r\n        async (decodedText) => {\r\n\r\n          const token = decodedText;\r\n          const device_fingerprint = generateDeviceFingerprint();\r\n\r\n          // ✅ GPS ACCESS\r\n          navigator.geolocation.getCurrentPosition(async (pos) => {\r\n            const { latitude, longitude } = pos.coords;\r\n\r\n            try {\r\n              // ✅ FIXED: correct student_id + correct API URL\r\n              const res = await axios.post(`${API_BASE}/attendance-token`, {\r\n                student_id: user.student_id,\r\n                token,\r\n                latitude,\r\n                longitude,\r\n                device_fingerprint\r\n              });\r\n\r\n              alert(res.data.message || \"Attendance Marked ✅\");\r\n              scanner.stop();\r\n            } catch (err) {\r\n              alert(\"Error: \" + (err.response?.data?.error || err.message));\r\n            }\r\n\r\n          }, () => {\r\n            alert(\"Turn on Location / GPS and try again.\");\r\n          });\r\n        }\r\n      );\r\n    }\r\n\r\n    startScanner();\r\n  }, [user]);\r\n\r\n  return (\r\n    <div className=\"qr-scanner-container\">\r\n      <h2>Scan QR Code</h2>\r\n      <p>Point your camera at the teacher's QR code.</p>\r\n      <div id=\"reader\" style={{ width: \"300px\", margin: \"auto\" }}></div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}