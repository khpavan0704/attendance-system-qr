{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import{Html5Qrcode,Html5QrcodeSupportedFormats}from'html5-qrcode';import axios from'axios';import{generateDeviceFingerprint}from'../utils/deviceFingerprint';import'./QRScanner.css';import{API_BASE}from'../config';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function QRScanner(_ref){var _availableCameras$cur;let{user}=_ref;const html5QrCodeRef=useRef(null);const[error,setError]=useState(null);const[isRetrying,setIsRetrying]=useState(false);const[isScanning,setIsScanning]=useState(false);const[scanMode,setScanMode]=useState('camera');// 'camera' or 'manual'\nconst[manualToken,setManualToken]=useState('');const cameraRunningRef=useRef(false);const[availableCameras,setAvailableCameras]=useState([]);const[currentCameraIndex,setCurrentCameraIndex]=useState(0);const[isSwitchingCamera,setIsSwitchingCamera]=useState(false);const isSwitchingCameraRef=useRef(false);const stopCameraSafely=async function(){let updateState=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;if(html5QrCodeRef.current&&cameraRunningRef.current){try{await html5QrCodeRef.current.stop();}catch(e){console.warn(\"Camera stop warning:\",(e===null||e===void 0?void 0:e.message)||e);}try{await html5QrCodeRef.current.clear();}catch(e){console.warn(\"Camera clear warning:\",(e===null||e===void 0?void 0:e.message)||e);}html5QrCodeRef.current=null;cameraRunningRef.current=false;if(updateState){setIsScanning(false);}}};useEffect(()=>{// Only initialize camera if scanMode is 'camera'\nif(scanMode!=='camera'){return;}let isMounted=true;// Define handleCameraError first\nconst handleCameraError=errorMessage=>{if(!isMounted)return;let userFriendlyMessage=\"Camera error: \";if(errorMessage.includes(\"NotReadableError\")||errorMessage.includes(\"Could not start video source\")){userFriendlyMessage+=\"Camera is already in use by another app. Please close other apps using the camera and try again.\";}else if(errorMessage.includes(\"Permission denied\")||errorMessage.includes(\"NotAllowedError\")){userFriendlyMessage+=\"Camera permission was denied. Please allow camera access in your browser settings and refresh the page.\";}else if(errorMessage.includes(\"NotFoundError\")||errorMessage.includes(\"no camera\")){userFriendlyMessage+=\"No camera found on this device.\";}else{userFriendlyMessage+=errorMessage;}setError(userFriendlyMessage);setIsScanning(false);cameraRunningRef.current=false;};// Global error handler to catch unhandled errors\nconst globalErrorHandler=event=>{var _event$error$message,_event$error$message2,_event$error$message3;if(event.error&&((_event$error$message=event.error.message)!==null&&_event$error$message!==void 0&&_event$error$message.includes(\"NotReadableError\")||(_event$error$message2=event.error.message)!==null&&_event$error$message2!==void 0&&_event$error$message2.includes(\"Could not start video source\")||(_event$error$message3=event.error.message)!==null&&_event$error$message3!==void 0&&_event$error$message3.includes(\"userMedia\")||event.error.name===\"NotReadableError\")){event.preventDefault();if(isMounted){handleCameraError(event.error.message||\"Camera error: Could not start video source. Please close other apps using the camera.\");}}};// Add global error listener\nwindow.addEventListener('error',globalErrorHandler);window.addEventListener('unhandledrejection',event=>{var _event$reason$message,_event$reason$message2,_event$reason$message3;if(event.reason&&((_event$reason$message=event.reason.message)!==null&&_event$reason$message!==void 0&&_event$reason$message.includes(\"NotReadableError\")||(_event$reason$message2=event.reason.message)!==null&&_event$reason$message2!==void 0&&_event$reason$message2.includes(\"Could not start video source\")||(_event$reason$message3=event.reason.message)!==null&&_event$reason$message3!==void 0&&_event$reason$message3.includes(\"userMedia\"))){event.preventDefault();if(isMounted){handleCameraError(event.reason.message||\"Camera error: Could not start video source.\");}}});const handleScanSuccess=async(token,scanner)=>{if(!isMounted)return;try{// Stop scanning temporarily\nawait scanner.stop();setIsScanning(false);cameraRunningRef.current=false;navigator.geolocation.getCurrentPosition(async pos=>{if(!isMounted)return;const{latitude,longitude}=pos.coords;const device_fingerprint=generateDeviceFingerprint();try{const res=await axios.post(\"\".concat(API_BASE,\"/api/attendance-token\"),{student_id:user.id,token,latitude,longitude,device_fingerprint});if(res.data.error){alert(\"Error: \"+res.data.error);}else{alert(res.data.message||\"Attendance marked successfully!\");}// Restart scanner\nif(isMounted){startScanner();}}catch(err){var _err$response,_err$response$data;alert(\"Failed to mark attendance: \"+(((_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||err.message));// Restart scanner\nif(isMounted){startScanner();}}},()=>{alert(\"Enable GPS to mark attendance.\");// Restart scanner\nif(isMounted){startScanner();}});}catch(e){console.error(\"Error handling scan:\",e);if(isMounted){startScanner();}}};const startScanner=async()=>{if(!isMounted)return;// Clear any previous error\nsetError(null);// Check if getUserMedia is supported - Chrome and all modern browsers support this\nconst hasModernAPI=navigator.mediaDevices&&typeof navigator.mediaDevices.getUserMedia==='function';const hasLegacyAPI=navigator.getUserMedia&&typeof navigator.getUserMedia==='function'||navigator.webkitGetUserMedia&&typeof navigator.webkitGetUserMedia==='function'||navigator.mozGetUserMedia&&typeof navigator.mozGetUserMedia==='function'||navigator.msGetUserMedia&&typeof navigator.msGetUserMedia==='function';// Debug logging\nconsole.log(\"Camera API Check:\",{hasModernAPI,hasLegacyAPI,userAgent:navigator.userAgent,protocol:window.location.protocol,hostname:window.location.hostname});// If neither modern nor legacy API exists, show error\nif(!hasModernAPI&&!hasLegacyAPI){const errorMsg=\"Camera access is not supported in this browser. Please use Chrome, Firefox, Safari, or Edge (latest version).\";console.error(\"Camera not supported:\",errorMsg);setError(errorMsg);return;}// Create a wrapper function for getUserMedia that works with all browsers\nconst requestUserMedia=async constraints=>{// Modern browsers (Chrome, Firefox, Safari, Edge)\nif(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){return navigator.mediaDevices.getUserMedia(constraints);}// Legacy browsers - wrap in Promise\nconst legacyGetUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(legacyGetUserMedia){return new Promise((resolve,reject)=>{legacyGetUserMedia.call(navigator,constraints,resolve,reject);});}throw new Error(\"getUserMedia not supported\");};// Check if we're on HTTPS or localhost (required for camera access)\nconst isSecureContext=window.isSecureContext||window.location.protocol==='https:'||window.location.hostname==='localhost'||window.location.hostname==='127.0.0.1'||window.location.hostname.startsWith('192.168.')||window.location.hostname.startsWith('10.')||window.location.hostname.startsWith('172.')||window.location.hostname.includes('ngrok');// Warn but don't block - some browsers allow camera on local network\nif(!isSecureContext){console.warn(\"Not a secure context - camera may not work. Use HTTPS or localhost for best results.\");// Don't return - try anyway, some browsers allow camera on local network IPs\n}// Clean up any existing scanner\nif(html5QrCodeRef.current){await stopCameraSafely();}const qrboxSize=window.innerWidth<480?220:280;const html5QrCode=new Html5Qrcode(\"reader\");html5QrCodeRef.current=html5QrCode;// Detect if device is mobile\nconst isMobile=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768&&window.innerHeight<=1024;try{// Step 1: Request camera permission explicitly first\n// For mobile: prioritize back camera (environment)\n// For laptop/desktop: use any available camera\nconsole.log(\"Starting camera permission request...\",{isMobile});try{let stream;if(isMobile){// Mobile: Try back camera first (environment), then any camera\ntry{stream=await requestUserMedia({video:{facingMode:\"environment\"}});}catch(envErr){// If environment fails, try any camera\ntry{stream=await requestUserMedia({video:true});}catch(anyErr){// Last resort: try basic video constraint\nstream=await requestUserMedia({video:{}});}}}else{// Desktop/Laptop: Try any camera first\ntry{stream=await requestUserMedia({video:true});}catch(err){// If that fails, try environment facing\ntry{stream=await requestUserMedia({video:{facingMode:\"environment\"}});}catch(envErr){// Last resort: try basic video constraint\nstream=await requestUserMedia({video:{}});}}}// Stop the test stream immediately after getting permission\nif(stream&&stream.getTracks){stream.getTracks().forEach(track=>track.stop());}}catch(permErr){if(isMounted){console.error(\"Camera permission error:\",permErr);if(permErr.name===\"NotAllowedError\"||permErr.name===\"PermissionDeniedError\"){handleCameraError(\"Camera permission was denied. Please click 'Allow' when your browser asks for camera permission, then refresh the page.\");}else if(permErr.name===\"NotFoundError\"||permErr.name===\"DevicesNotFoundError\"){handleCameraError(\"No camera found on this device. Please connect a camera and try again.\");}else if(permErr.name===\"NotReadableError\"||permErr.name===\"TrackStartError\"){handleCameraError(\"Camera is already in use by another app. Please close other apps using the camera and try again.\");}else{handleCameraError(\"Camera access error: \".concat(permErr.message||permErr.name,\". Please check your camera permissions in browser settings.\"));}return;}}// Step 2: Get available cameras\nlet cameraId=null;let selectedIndex=currentCameraIndex;// Use current index if switching cameras\nlet devices=[];try{// Try to get cameras - this might fail on some browsers\ntry{devices=await Html5Qrcode.getCameras();}catch(camErr){console.warn(\"Could not enumerate cameras, will use default:\",camErr);devices=[];// Empty array, will use default camera\n}if(devices&&devices.length>0){// Store available cameras for switching\nif(isMounted){setAvailableCameras(devices);}// If we're switching cameras and have a valid index, use it\n// Otherwise, prefer back camera on mobile, or first camera on laptop\nif(isSwitchingCameraRef.current&&currentCameraIndex>=0&&currentCameraIndex<devices.length){// We're switching cameras - use the selected index\nselectedIndex=currentCameraIndex;isSwitchingCameraRef.current=false;// Reset flag\n}else{// First time or reset - select best camera\n// For mobile: prefer back camera (environment)\n// For laptop/desktop: use any available camera (usually front-facing is fine)\nconst backCameraIndex=devices.findIndex(device=>device.label.toLowerCase().includes('back')||device.label.toLowerCase().includes('rear')||device.label.toLowerCase().includes('environment'));// If back camera found, use it; otherwise use first camera\nselectedIndex=backCameraIndex>=0?backCameraIndex:0;}cameraId=devices[selectedIndex].id;if(isMounted){setCurrentCameraIndex(selectedIndex);}}}catch(e){console.log(\"Could not enumerate cameras, using default:\",e);}// Step 3: Mobile-friendly camera configuration\nconst config={fps:isMobile?5:10,// Lower FPS on mobile for better performance\nqrbox:{width:qrboxSize,height:qrboxSize},aspectRatio:1.0,formatsToSupport:[Html5QrcodeSupportedFormats.QR_CODE]};// Step 4: Start the scanner with comprehensive error handling\ntry{// Add delay to ensure camera is ready (longer for mobile)\nawait new Promise(resolve=>setTimeout(resolve,isMobile?800:500));// Use cameraId if available, otherwise use appropriate fallback\nlet cameraConfig;if(cameraId){cameraConfig=cameraId;}else if(devices&&devices.length>0){cameraConfig=devices[0].id;}else if(isMobile){// Mobile: prefer back camera\ncameraConfig={facingMode:\"environment\"};}else{// Desktop/Laptop: use front camera (user facing)\ncameraConfig={facingMode:\"user\"};}await html5QrCode.start(cameraConfig,config,decodedText=>{// Success callback\nif(isMounted){const token=decodedText;handleScanSuccess(token,html5QrCode);}},errorMessage=>{// Error callback - catch all camera-related errors\nif(isMounted){const errorStr=(errorMessage===null||errorMessage===void 0?void 0:errorMessage.toString())||String(errorMessage)||'';if(errorStr.includes(\"NotReadableError\")||errorStr.includes(\"Could not start video source\")||errorStr.includes(\"Permission denied\")||errorStr.includes(\"NotFoundError\")||errorStr.includes(\"NotAllowedError\")||errorStr.includes(\"TrackStartError\")||errorStr.includes(\"DevicesNotFoundError\")||errorStr.includes(\"getUserMedia\")){handleCameraError(errorStr);}}}).catch(err=>{// Additional catch for promise rejection\nif(isMounted){console.error(\"Camera start error:\",err);const errorStr=(err===null||err===void 0?void 0:err.message)||(err===null||err===void 0?void 0:err.toString())||String(err);if(errorStr.includes(\"NotReadableError\")||errorStr.includes(\"Could not start video source\")){handleCameraError(\"Camera is already in use by another app. Please close other apps using the camera and try again.\");}else if(errorStr.includes(\"NotAllowedError\")||errorStr.includes(\"Permission denied\")){handleCameraError(\"Camera permission was denied. Please allow camera access in your browser settings and refresh the page.\");}else if(errorStr.includes(\"NotFoundError\")){handleCameraError(\"No camera found. Please check your device has a camera and try again.\");}else{handleCameraError(\"Camera error: \".concat(errorStr,\". Please try refreshing the page or use manual token entry.\"));}}});if(isMounted){cameraRunningRef.current=true;setIsScanning(true);}}catch(startErr){// Catch any errors during start()\nif(isMounted){console.error(\"Camera initialization error:\",startErr);const errorStr=(startErr===null||startErr===void 0?void 0:startErr.message)||(startErr===null||startErr===void 0?void 0:startErr.toString())||String(startErr);if(errorStr.includes(\"NotReadableError\")||errorStr.includes(\"Could not start video source\")){handleCameraError(\"Camera is already in use by another app. Please close other apps using the camera and try again.\");}else if(errorStr.includes(\"Permission denied\")||errorStr.includes(\"NotAllowedError\")){handleCameraError(\"Camera permission was denied. Please allow camera access in your browser settings and refresh the page.\");}else if(errorStr.includes(\"NotFoundError\")){handleCameraError(\"No camera found on this device. Please check your device has a camera.\");}else{handleCameraError(\"Failed to start camera: \".concat(errorStr,\". Please try refreshing the page or use manual token entry.\"));}}}}catch(err){// Final catch-all for any unexpected errors\nif(isMounted){const errorStr=err.message||err.toString();handleCameraError(\"Camera initialization error: \".concat(errorStr));}}};startScanner();return()=>{isMounted=false;// Remove global error listeners\nwindow.removeEventListener('error',globalErrorHandler);stopCameraSafely(false);};},[user,isRetrying,scanMode,currentCameraIndex]);// eslint-disable-line react-hooks/exhaustive-deps\nconst handleRetry=async()=>{setError(null);await stopCameraSafely();// Small delay to ensure cleanup is complete, then trigger retry\nsetTimeout(()=>{setIsRetrying(prev=>!prev);},500);};const handleSwitchCamera=async()=>{if(availableCameras.length<=1){setError('Only one camera is available on this device.');return;}setIsSwitchingCamera(true);setError(null);isSwitchingCameraRef.current=true;// Set flag for camera switching\n// Stop current camera\nawait stopCameraSafely(false);// Switch to next camera\nconst nextIndex=(currentCameraIndex+1)%availableCameras.length;setCurrentCameraIndex(nextIndex);// Small delay before restarting\nsetTimeout(()=>{setIsRetrying(prev=>!prev);setIsSwitchingCamera(false);},500);};const handleManualSubmit=async()=>{if(!manualToken.trim()){setError('Please enter the token');return;}setError(null);const token=manualToken.trim();// Use the same success handler as camera scan\nnavigator.geolocation.getCurrentPosition(async pos=>{const{latitude,longitude}=pos.coords;const device_fingerprint=generateDeviceFingerprint();try{const res=await axios.post(\"\".concat(API_BASE,\"/api/attendance-token\"),{student_id:user.id,token,latitude,longitude,device_fingerprint});if(res.data.error){setError(\"Error: \"+res.data.error);}else{alert(res.data.message||\"Attendance marked successfully!\");setManualToken('');// Clear input\n}}catch(err){var _err$response2,_err$response2$data;setError(\"Failed to mark attendance: \"+(((_err$response2=err.response)===null||_err$response2===void 0?void 0:(_err$response2$data=_err$response2.data)===null||_err$response2$data===void 0?void 0:_err$response2$data.error)||err.message));}},()=>{setError(\"Enable GPS to mark attendance.\");});};return/*#__PURE__*/_jsxs(\"div\",{className:\"qr-scanner-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"qr-scanner-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Mark Attendance\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'10px',marginBottom:'20px',justifyContent:'center'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setScanMode('camera');setError(null);setManualToken('');if(!cameraRunningRef.current){setIsRetrying(prev=>!prev);}},style:{padding:'10px 20px',backgroundColor:scanMode==='camera'?'#4CAF50':'#e0e0e0',color:scanMode==='camera'?'white':'#333',border:'none',borderRadius:'5px',cursor:'pointer',fontSize:'14px',fontWeight:scanMode==='camera'?'bold':'normal'},children:\"\\uD83D\\uDCF7 Scan QR Code\"}),/*#__PURE__*/_jsx(\"button\",{onClick:async()=>{setScanMode('manual');setError(null);await stopCameraSafely();},style:{padding:'10px 20px',backgroundColor:scanMode==='manual'?'#4CAF50':'#e0e0e0',color:scanMode==='manual'?'white':'#333',border:'none',borderRadius:'5px',cursor:'pointer',fontSize:'14px',fontWeight:scanMode==='manual'?'bold':'normal'},children:\"\\u2328\\uFE0F Enter Token\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:'#e3f2fd',border:'1px solid #2196F3',borderRadius:'8px',padding:'12px',marginBottom:'15px',fontSize:'13px',color:'#1565c0'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u26A0\\uFE0F Important:\"}),\" You must be physically present in the classroom to mark attendance. GPS location verification is required. Remote attendance is blocked.\"]}),scanMode==='camera'?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{style:{marginBottom:'10px'},children:\"Point your camera at the QR code displayed in class. Your location and device information will be verified.\"}),!isScanning&&!error&&/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:'#fff3cd',border:'1px solid #ffc107',borderRadius:'8px',padding:'12px',marginBottom:'15px',fontSize:'13px',color:'#856404'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCF7 Camera Permission:\"}),\" Your browser will ask for camera permission. Please click \",/*#__PURE__*/_jsx(\"strong\",{children:\"\\\"Allow\\\"\"}),\" to enable QR code scanning.\"]}),availableCameras.length>1&&/*#__PURE__*/_jsx(\"button\",{onClick:handleSwitchCamera,disabled:isSwitchingCamera,style:{padding:'8px 16px',backgroundColor:isSwitchingCamera?'#ccc':'#2196F3',color:'white',border:'none',borderRadius:'5px',cursor:isSwitchingCamera?'not-allowed':'pointer',fontSize:'14px',marginTop:'10px'},children:isSwitchingCamera?'ðŸ”„ Switching...':'ðŸ”„ Switch Camera'}),availableCameras.length>0&&/*#__PURE__*/_jsxs(\"p\",{style:{fontSize:'12px',color:'#666',marginTop:'8px',fontStyle:'italic'},children:[\"Using: \",((_availableCameras$cur=availableCameras[currentCameraIndex])===null||_availableCameras$cur===void 0?void 0:_availableCameras$cur.label)||'Camera '+(currentCameraIndex+1)]})]}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{style:{marginBottom:'15px'},children:\"Enter the token shown by your teacher on the projector screen.\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexDirection:'column',gap:'10px',maxWidth:'400px',margin:'0 auto'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:manualToken,onChange:e=>setManualToken(e.target.value),placeholder:\"Enter token here (e.g., CLASS-123-4567890)\",style:{padding:'12px',fontSize:'16px',border:'2px solid #ddd',borderRadius:'5px',textAlign:'center'},onKeyPress:e=>{if(e.key==='Enter'){handleManualSubmit();}}}),/*#__PURE__*/_jsx(\"button\",{onClick:handleManualSubmit,style:{padding:'12px 24px',backgroundColor:'#4CAF50',color:'white',border:'none',borderRadius:'5px',cursor:'pointer',fontSize:'16px',fontWeight:'bold'},children:\"Submit Token\"})]})]})]}),scanMode==='camera'&&!isScanning&&!error&&/*#__PURE__*/_jsx(\"div\",{style:{backgroundColor:'#e3f2fd',border:'1px solid #90caf9',borderRadius:'8px',padding:'15px',margin:'15px 0',color:'#1565c0',textAlign:'center'},children:\"Initializing camera...\"}),error&&/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:'#fee',border:'1px solid #fcc',borderRadius:'8px',padding:'15px',margin:'15px 0',color:'#c33'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Error:\"}),\" \",error,/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'10px'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleRetry,style:{padding:'8px 16px',backgroundColor:'#4CAF50',color:'white',border:'none',borderRadius:'4px',cursor:'pointer',fontSize:'14px',marginRight:'10px'},children:\"Retry Camera\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>window.location.reload(),style:{padding:'8px 16px',backgroundColor:'#2196F3',color:'white',border:'none',borderRadius:'4px',cursor:'pointer',fontSize:'14px'},children:\"Refresh Page\"})]})]}),scanMode==='camera'&&/*#__PURE__*/_jsx(\"div\",{className:\"qr-reader-wrapper\",children:/*#__PURE__*/_jsx(\"div\",{id:\"reader\"})}),scanMode==='manual'&&/*#__PURE__*/_jsx(\"div\",{style:{textAlign:'center',padding:'20px',backgroundColor:'#f5f5f5',borderRadius:'8px',marginTop:'20px'},children:/*#__PURE__*/_jsxs(\"p\",{style:{color:'#666',fontSize:'14px'},children:[\"\\uD83D\\uDCA1 \",/*#__PURE__*/_jsx(\"strong\",{children:\"Tip:\"}),\" Look at the projector screen for the token text below the QR code. Type it exactly as shown (including dashes and numbers).\"]})})]});}","map":{"version":3,"names":["React","useEffect","useRef","useState","Html5Qrcode","Html5QrcodeSupportedFormats","axios","generateDeviceFingerprint","API_BASE","jsx","_jsx","jsxs","_jsxs","QRScanner","_ref","_availableCameras$cur","user","html5QrCodeRef","error","setError","isRetrying","setIsRetrying","isScanning","setIsScanning","scanMode","setScanMode","manualToken","setManualToken","cameraRunningRef","availableCameras","setAvailableCameras","currentCameraIndex","setCurrentCameraIndex","isSwitchingCamera","setIsSwitchingCamera","isSwitchingCameraRef","stopCameraSafely","updateState","arguments","length","undefined","current","stop","e","console","warn","message","clear","isMounted","handleCameraError","errorMessage","userFriendlyMessage","includes","globalErrorHandler","event","_event$error$message","_event$error$message2","_event$error$message3","name","preventDefault","window","addEventListener","_event$reason$message","_event$reason$message2","_event$reason$message3","reason","handleScanSuccess","token","scanner","navigator","geolocation","getCurrentPosition","pos","latitude","longitude","coords","device_fingerprint","res","post","concat","student_id","id","data","alert","startScanner","err","_err$response","_err$response$data","response","hasModernAPI","mediaDevices","getUserMedia","hasLegacyAPI","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","log","userAgent","protocol","location","hostname","errorMsg","requestUserMedia","constraints","legacyGetUserMedia","Promise","resolve","reject","call","Error","isSecureContext","startsWith","qrboxSize","innerWidth","html5QrCode","isMobile","test","innerHeight","stream","video","facingMode","envErr","anyErr","getTracks","forEach","track","permErr","cameraId","selectedIndex","devices","getCameras","camErr","backCameraIndex","findIndex","device","label","toLowerCase","config","fps","qrbox","width","height","aspectRatio","formatsToSupport","QR_CODE","setTimeout","cameraConfig","start","decodedText","errorStr","toString","String","catch","startErr","removeEventListener","handleRetry","prev","handleSwitchCamera","nextIndex","handleManualSubmit","trim","_err$response2","_err$response2$data","className","children","style","display","gap","marginBottom","justifyContent","onClick","padding","backgroundColor","color","border","borderRadius","cursor","fontSize","fontWeight","disabled","marginTop","fontStyle","flexDirection","maxWidth","margin","type","value","onChange","target","placeholder","textAlign","onKeyPress","key","marginRight","reload"],"sources":["C:/Users/LENOVO/Downloads/attendance-system-qr/frontend/src/pages/QRScanner.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport { Html5Qrcode, Html5QrcodeSupportedFormats } from 'html5-qrcode';\r\nimport axios from 'axios';\r\nimport { generateDeviceFingerprint } from '../utils/deviceFingerprint';\r\nimport './QRScanner.css';\r\nimport { API_BASE } from '../config';\r\n\r\nexport default function QRScanner({ user }) {\r\n  const html5QrCodeRef = useRef(null);\r\n  const [error, setError] = useState(null);\r\n  const [isRetrying, setIsRetrying] = useState(false);\r\n  const [isScanning, setIsScanning] = useState(false);\r\n  const [scanMode, setScanMode] = useState('camera'); // 'camera' or 'manual'\r\n  const [manualToken, setManualToken] = useState('');\r\n  const cameraRunningRef = useRef(false);\r\n  const [availableCameras, setAvailableCameras] = useState([]);\r\n  const [currentCameraIndex, setCurrentCameraIndex] = useState(0);\r\n  const [isSwitchingCamera, setIsSwitchingCamera] = useState(false);\r\n  const isSwitchingCameraRef = useRef(false);\r\n\r\n  const stopCameraSafely = async (updateState = true) => {\r\n    if (html5QrCodeRef.current && cameraRunningRef.current) {\r\n      try {\r\n        await html5QrCodeRef.current.stop();\r\n      } catch (e) {\r\n        console.warn(\"Camera stop warning:\", e?.message || e);\r\n      }\r\n      try {\r\n        await html5QrCodeRef.current.clear();\r\n      } catch (e) {\r\n        console.warn(\"Camera clear warning:\", e?.message || e);\r\n      }\r\n      html5QrCodeRef.current = null;\r\n      cameraRunningRef.current = false;\r\n      if (updateState) {\r\n        setIsScanning(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // Only initialize camera if scanMode is 'camera'\r\n    if (scanMode !== 'camera') {\r\n      return;\r\n    }\r\n\r\n    let isMounted = true;\r\n    \r\n    // Define handleCameraError first\r\n    const handleCameraError = (errorMessage) => {\r\n      if (!isMounted) return;\r\n      \r\n      let userFriendlyMessage = \"Camera error: \";\r\n      \r\n      if (errorMessage.includes(\"NotReadableError\") || errorMessage.includes(\"Could not start video source\")) {\r\n        userFriendlyMessage += \"Camera is already in use by another app. Please close other apps using the camera and try again.\";\r\n      } else if (errorMessage.includes(\"Permission denied\") || errorMessage.includes(\"NotAllowedError\")) {\r\n        userFriendlyMessage += \"Camera permission was denied. Please allow camera access in your browser settings and refresh the page.\";\r\n      } else if (errorMessage.includes(\"NotFoundError\") || errorMessage.includes(\"no camera\")) {\r\n        userFriendlyMessage += \"No camera found on this device.\";\r\n      } else {\r\n        userFriendlyMessage += errorMessage;\r\n      }\r\n      \r\n      setError(userFriendlyMessage);\r\n      setIsScanning(false);\r\n    cameraRunningRef.current = false;\r\n    };\r\n    \r\n    // Global error handler to catch unhandled errors\r\n    const globalErrorHandler = (event) => {\r\n      if (event.error && (\r\n        event.error.message?.includes(\"NotReadableError\") ||\r\n        event.error.message?.includes(\"Could not start video source\") ||\r\n        event.error.message?.includes(\"userMedia\") ||\r\n        event.error.name === \"NotReadableError\"\r\n      )) {\r\n        event.preventDefault();\r\n        if (isMounted) {\r\n          handleCameraError(event.error.message || \"Camera error: Could not start video source. Please close other apps using the camera.\");\r\n        }\r\n      }\r\n    };\r\n\r\n    // Add global error listener\r\n    window.addEventListener('error', globalErrorHandler);\r\n    window.addEventListener('unhandledrejection', (event) => {\r\n      if (event.reason && (\r\n        event.reason.message?.includes(\"NotReadableError\") ||\r\n        event.reason.message?.includes(\"Could not start video source\") ||\r\n        event.reason.message?.includes(\"userMedia\")\r\n      )) {\r\n        event.preventDefault();\r\n        if (isMounted) {\r\n          handleCameraError(event.reason.message || \"Camera error: Could not start video source.\");\r\n        }\r\n      }\r\n    });\r\n\r\n    const handleScanSuccess = async (token, scanner) => {\r\n      if (!isMounted) return;\r\n      \r\n      try {\r\n        // Stop scanning temporarily\r\n        await scanner.stop();\r\n        setIsScanning(false);\r\n        cameraRunningRef.current = false;\r\n\r\n        navigator.geolocation.getCurrentPosition(\r\n          async (pos) => {\r\n            if (!isMounted) return;\r\n            \r\n            const { latitude, longitude } = pos.coords;\r\n            const device_fingerprint = generateDeviceFingerprint();\r\n\r\n            try {\r\n              const res = await axios.post(`${API_BASE}/api/attendance-token`, {\r\n                student_id: user.id,\r\n                token,\r\n                latitude,\r\n                longitude,\r\n                device_fingerprint\r\n              });\r\n\r\n              if (res.data.error) {\r\n                alert(\"Error: \" + res.data.error);\r\n              } else {\r\n                alert(res.data.message || \"Attendance marked successfully!\");\r\n              }\r\n              \r\n              // Restart scanner\r\n              if (isMounted) {\r\n                startScanner();\r\n              }\r\n            } catch (err) {\r\n              alert(\"Failed to mark attendance: \" + (err.response?.data?.error || err.message));\r\n              // Restart scanner\r\n              if (isMounted) {\r\n                startScanner();\r\n              }\r\n            }\r\n          },\r\n          () => {\r\n            alert(\"Enable GPS to mark attendance.\");\r\n            // Restart scanner\r\n            if (isMounted) {\r\n              startScanner();\r\n            }\r\n          }\r\n        );\r\n      } catch (e) {\r\n        console.error(\"Error handling scan:\", e);\r\n        if (isMounted) {\r\n          startScanner();\r\n        }\r\n      }\r\n    };\r\n\r\n    const startScanner = async () => {\r\n      if (!isMounted) return;\r\n      \r\n      // Clear any previous error\r\n      setError(null);\r\n\r\n      // Check if getUserMedia is supported - Chrome and all modern browsers support this\r\n      const hasModernAPI = navigator.mediaDevices && typeof navigator.mediaDevices.getUserMedia === 'function';\r\n      const hasLegacyAPI = (navigator.getUserMedia && typeof navigator.getUserMedia === 'function') || \r\n                          (navigator.webkitGetUserMedia && typeof navigator.webkitGetUserMedia === 'function') || \r\n                          (navigator.mozGetUserMedia && typeof navigator.mozGetUserMedia === 'function') || \r\n                          (navigator.msGetUserMedia && typeof navigator.msGetUserMedia === 'function');\r\n\r\n      // Debug logging\r\n      console.log(\"Camera API Check:\", {\r\n        hasModernAPI,\r\n        hasLegacyAPI,\r\n        userAgent: navigator.userAgent,\r\n        protocol: window.location.protocol,\r\n        hostname: window.location.hostname\r\n      });\r\n\r\n      // If neither modern nor legacy API exists, show error\r\n      if (!hasModernAPI && !hasLegacyAPI) {\r\n        const errorMsg = \"Camera access is not supported in this browser. Please use Chrome, Firefox, Safari, or Edge (latest version).\";\r\n        console.error(\"Camera not supported:\", errorMsg);\r\n        setError(errorMsg);\r\n        return;\r\n      }\r\n\r\n      // Create a wrapper function for getUserMedia that works with all browsers\r\n      const requestUserMedia = async (constraints) => {\r\n        // Modern browsers (Chrome, Firefox, Safari, Edge)\r\n        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n          return navigator.mediaDevices.getUserMedia(constraints);\r\n        }\r\n        \r\n        // Legacy browsers - wrap in Promise\r\n        const legacyGetUserMedia = navigator.getUserMedia || \r\n                                  navigator.webkitGetUserMedia || \r\n                                  navigator.mozGetUserMedia || \r\n                                  navigator.msGetUserMedia;\r\n        \r\n        if (legacyGetUserMedia) {\r\n          return new Promise((resolve, reject) => {\r\n            legacyGetUserMedia.call(navigator, constraints, resolve, reject);\r\n          });\r\n        }\r\n        \r\n        throw new Error(\"getUserMedia not supported\");\r\n      };\r\n\r\n      // Check if we're on HTTPS or localhost (required for camera access)\r\n      const isSecureContext = window.isSecureContext || \r\n        window.location.protocol === 'https:' || \r\n        window.location.hostname === 'localhost' || \r\n        window.location.hostname === '127.0.0.1' ||\r\n        window.location.hostname.startsWith('192.168.') ||\r\n        window.location.hostname.startsWith('10.') ||\r\n        window.location.hostname.startsWith('172.') ||\r\n        window.location.hostname.includes('ngrok');\r\n\r\n      // Warn but don't block - some browsers allow camera on local network\r\n      if (!isSecureContext) {\r\n        console.warn(\"Not a secure context - camera may not work. Use HTTPS or localhost for best results.\");\r\n        // Don't return - try anyway, some browsers allow camera on local network IPs\r\n      }\r\n\r\n      // Clean up any existing scanner\r\n      if (html5QrCodeRef.current) {\r\n        await stopCameraSafely();\r\n      }\r\n\r\n      const qrboxSize = window.innerWidth < 480 ? 220 : 280;\r\n      const html5QrCode = new Html5Qrcode(\"reader\");\r\n      html5QrCodeRef.current = html5QrCode;\r\n\r\n      // Detect if device is mobile\r\n      const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || \r\n                       (window.innerWidth <= 768 && window.innerHeight <= 1024);\r\n\r\n      try {\r\n        // Step 1: Request camera permission explicitly first\r\n        // For mobile: prioritize back camera (environment)\r\n        // For laptop/desktop: use any available camera\r\n        console.log(\"Starting camera permission request...\", { isMobile });\r\n        try {\r\n          let stream;\r\n          if (isMobile) {\r\n            // Mobile: Try back camera first (environment), then any camera\r\n            try {\r\n              stream = await requestUserMedia({ \r\n                video: { facingMode: \"environment\" } \r\n              });\r\n            } catch (envErr) {\r\n              // If environment fails, try any camera\r\n              try {\r\n                stream = await requestUserMedia({ \r\n                  video: true \r\n                });\r\n              } catch (anyErr) {\r\n                // Last resort: try basic video constraint\r\n                stream = await requestUserMedia({ \r\n                  video: {} \r\n                });\r\n              }\r\n            }\r\n          } else {\r\n            // Desktop/Laptop: Try any camera first\r\n            try {\r\n              stream = await requestUserMedia({ \r\n                video: true \r\n              });\r\n            } catch (err) {\r\n              // If that fails, try environment facing\r\n              try {\r\n                stream = await requestUserMedia({ \r\n                  video: { facingMode: \"environment\" } \r\n                });\r\n              } catch (envErr) {\r\n                // Last resort: try basic video constraint\r\n                stream = await requestUserMedia({ \r\n                  video: {} \r\n                });\r\n              }\r\n            }\r\n          }\r\n          // Stop the test stream immediately after getting permission\r\n          if (stream && stream.getTracks) {\r\n            stream.getTracks().forEach(track => track.stop());\r\n          }\r\n        } catch (permErr) {\r\n          if (isMounted) {\r\n            console.error(\"Camera permission error:\", permErr);\r\n            if (permErr.name === \"NotAllowedError\" || permErr.name === \"PermissionDeniedError\") {\r\n              handleCameraError(\"Camera permission was denied. Please click 'Allow' when your browser asks for camera permission, then refresh the page.\");\r\n            } else if (permErr.name === \"NotFoundError\" || permErr.name === \"DevicesNotFoundError\") {\r\n              handleCameraError(\"No camera found on this device. Please connect a camera and try again.\");\r\n            } else if (permErr.name === \"NotReadableError\" || permErr.name === \"TrackStartError\") {\r\n              handleCameraError(\"Camera is already in use by another app. Please close other apps using the camera and try again.\");\r\n            } else {\r\n              handleCameraError(`Camera access error: ${permErr.message || permErr.name}. Please check your camera permissions in browser settings.`);\r\n            }\r\n            return;\r\n          }\r\n        }\r\n\r\n        // Step 2: Get available cameras\r\n        let cameraId = null;\r\n        let selectedIndex = currentCameraIndex; // Use current index if switching cameras\r\n        let devices = [];\r\n        try {\r\n          // Try to get cameras - this might fail on some browsers\r\n          try {\r\n            devices = await Html5Qrcode.getCameras();\r\n          } catch (camErr) {\r\n            console.warn(\"Could not enumerate cameras, will use default:\", camErr);\r\n            devices = []; // Empty array, will use default camera\r\n          }\r\n          \r\n          if (devices && devices.length > 0) {\r\n            // Store available cameras for switching\r\n            if (isMounted) {\r\n              setAvailableCameras(devices);\r\n            }\r\n            \r\n            // If we're switching cameras and have a valid index, use it\r\n            // Otherwise, prefer back camera on mobile, or first camera on laptop\r\n            if (isSwitchingCameraRef.current && currentCameraIndex >= 0 && currentCameraIndex < devices.length) {\r\n              // We're switching cameras - use the selected index\r\n              selectedIndex = currentCameraIndex;\r\n              isSwitchingCameraRef.current = false; // Reset flag\r\n            } else {\r\n              // First time or reset - select best camera\r\n              // For mobile: prefer back camera (environment)\r\n              // For laptop/desktop: use any available camera (usually front-facing is fine)\r\n              const backCameraIndex = devices.findIndex(device => \r\n                device.label.toLowerCase().includes('back') || \r\n                device.label.toLowerCase().includes('rear') ||\r\n                device.label.toLowerCase().includes('environment')\r\n              );\r\n              \r\n              // If back camera found, use it; otherwise use first camera\r\n              selectedIndex = backCameraIndex >= 0 ? backCameraIndex : 0;\r\n            }\r\n            \r\n            cameraId = devices[selectedIndex].id;\r\n            \r\n            if (isMounted) {\r\n              setCurrentCameraIndex(selectedIndex);\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.log(\"Could not enumerate cameras, using default:\", e);\r\n        }\r\n\r\n        // Step 3: Mobile-friendly camera configuration\r\n        const config = {\r\n          fps: isMobile ? 5 : 10, // Lower FPS on mobile for better performance\r\n          qrbox: { width: qrboxSize, height: qrboxSize },\r\n          aspectRatio: 1.0,\r\n          formatsToSupport: [Html5QrcodeSupportedFormats.QR_CODE]\r\n        };\r\n\r\n        // Step 4: Start the scanner with comprehensive error handling\r\n        try {\r\n          // Add delay to ensure camera is ready (longer for mobile)\r\n          await new Promise(resolve => setTimeout(resolve, isMobile ? 800 : 500));\r\n          \r\n          // Use cameraId if available, otherwise use appropriate fallback\r\n          let cameraConfig;\r\n          if (cameraId) {\r\n            cameraConfig = cameraId;\r\n          } else if (devices && devices.length > 0) {\r\n            cameraConfig = devices[0].id;\r\n          } else if (isMobile) {\r\n            // Mobile: prefer back camera\r\n            cameraConfig = { facingMode: \"environment\" };\r\n          } else {\r\n            // Desktop/Laptop: use front camera (user facing)\r\n            cameraConfig = { facingMode: \"user\" };\r\n          }\r\n          \r\n          await html5QrCode.start(\r\n            cameraConfig,\r\n            config,\r\n            (decodedText) => {\r\n              // Success callback\r\n              if (isMounted) {\r\n                const token = decodedText;\r\n                handleScanSuccess(token, html5QrCode);\r\n              }\r\n            },\r\n            (errorMessage) => {\r\n              // Error callback - catch all camera-related errors\r\n              if (isMounted) {\r\n                const errorStr = errorMessage?.toString() || String(errorMessage) || '';\r\n                if (errorStr.includes(\"NotReadableError\") || \r\n                    errorStr.includes(\"Could not start video source\") ||\r\n                    errorStr.includes(\"Permission denied\") ||\r\n                    errorStr.includes(\"NotFoundError\") ||\r\n                    errorStr.includes(\"NotAllowedError\") ||\r\n                    errorStr.includes(\"TrackStartError\") ||\r\n                    errorStr.includes(\"DevicesNotFoundError\") ||\r\n                    errorStr.includes(\"getUserMedia\")) {\r\n                  handleCameraError(errorStr);\r\n                }\r\n              }\r\n            }\r\n          ).catch((err) => {\r\n            // Additional catch for promise rejection\r\n            if (isMounted) {\r\n              console.error(\"Camera start error:\", err);\r\n              const errorStr = err?.message || err?.toString() || String(err);\r\n              if (errorStr.includes(\"NotReadableError\") || errorStr.includes(\"Could not start video source\")) {\r\n                handleCameraError(\"Camera is already in use by another app. Please close other apps using the camera and try again.\");\r\n              } else if (errorStr.includes(\"NotAllowedError\") || errorStr.includes(\"Permission denied\")) {\r\n                handleCameraError(\"Camera permission was denied. Please allow camera access in your browser settings and refresh the page.\");\r\n              } else if (errorStr.includes(\"NotFoundError\")) {\r\n                handleCameraError(\"No camera found. Please check your device has a camera and try again.\");\r\n              } else {\r\n                handleCameraError(`Camera error: ${errorStr}. Please try refreshing the page or use manual token entry.`);\r\n              }\r\n            }\r\n          });\r\n          \r\n          if (isMounted) {\r\n            cameraRunningRef.current = true;\r\n            setIsScanning(true);\r\n          }\r\n        } catch (startErr) {\r\n          // Catch any errors during start()\r\n          if (isMounted) {\r\n            console.error(\"Camera initialization error:\", startErr);\r\n            const errorStr = startErr?.message || startErr?.toString() || String(startErr);\r\n            if (errorStr.includes(\"NotReadableError\") || errorStr.includes(\"Could not start video source\")) {\r\n              handleCameraError(\"Camera is already in use by another app. Please close other apps using the camera and try again.\");\r\n            } else if (errorStr.includes(\"Permission denied\") || errorStr.includes(\"NotAllowedError\")) {\r\n              handleCameraError(\"Camera permission was denied. Please allow camera access in your browser settings and refresh the page.\");\r\n            } else if (errorStr.includes(\"NotFoundError\")) {\r\n              handleCameraError(\"No camera found on this device. Please check your device has a camera.\");\r\n            } else {\r\n              handleCameraError(`Failed to start camera: ${errorStr}. Please try refreshing the page or use manual token entry.`);\r\n            }\r\n          }\r\n        }\r\n      } catch (err) {\r\n        // Final catch-all for any unexpected errors\r\n        if (isMounted) {\r\n          const errorStr = err.message || err.toString();\r\n          handleCameraError(`Camera initialization error: ${errorStr}`);\r\n        }\r\n      }\r\n    };\r\n\r\n    startScanner();\r\n\r\n    return () => {\r\n      isMounted = false;\r\n      // Remove global error listeners\r\n      window.removeEventListener('error', globalErrorHandler);\r\n      stopCameraSafely(false);\r\n    };\r\n  }, [user, isRetrying, scanMode, currentCameraIndex]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  const handleRetry = async () => {\r\n    setError(null);\r\n    \r\n    await stopCameraSafely();\r\n    // Small delay to ensure cleanup is complete, then trigger retry\r\n    setTimeout(() => {\r\n      setIsRetrying(prev => !prev);\r\n    }, 500);\r\n  };\r\n\r\n  const handleSwitchCamera = async () => {\r\n    if (availableCameras.length <= 1) {\r\n      setError('Only one camera is available on this device.');\r\n      return;\r\n    }\r\n\r\n    setIsSwitchingCamera(true);\r\n    setError(null);\r\n    isSwitchingCameraRef.current = true; // Set flag for camera switching\r\n    \r\n    // Stop current camera\r\n    await stopCameraSafely(false);\r\n    \r\n    // Switch to next camera\r\n    const nextIndex = (currentCameraIndex + 1) % availableCameras.length;\r\n    setCurrentCameraIndex(nextIndex);\r\n    \r\n    // Small delay before restarting\r\n    setTimeout(() => {\r\n      setIsRetrying(prev => !prev);\r\n      setIsSwitchingCamera(false);\r\n    }, 500);\r\n  };\r\n\r\n  const handleManualSubmit = async () => {\r\n    if (!manualToken.trim()) {\r\n      setError('Please enter the token');\r\n      return;\r\n    }\r\n\r\n    setError(null);\r\n    const token = manualToken.trim();\r\n    \r\n    // Use the same success handler as camera scan\r\n    navigator.geolocation.getCurrentPosition(\r\n      async (pos) => {\r\n        const { latitude, longitude } = pos.coords;\r\n        const device_fingerprint = generateDeviceFingerprint();\r\n\r\n        try {\r\n          const res = await axios.post(`${API_BASE}/api/attendance-token`, {\r\n            student_id: user.id,\r\n            token,\r\n            latitude,\r\n            longitude,\r\n            device_fingerprint\r\n          });\r\n\r\n          if (res.data.error) {\r\n            setError(\"Error: \" + res.data.error);\r\n          } else {\r\n            alert(res.data.message || \"Attendance marked successfully!\");\r\n            setManualToken(''); // Clear input\r\n          }\r\n        } catch (err) {\r\n          setError(\"Failed to mark attendance: \" + (err.response?.data?.error || err.message));\r\n        }\r\n      },\r\n      () => {\r\n        setError(\"Enable GPS to mark attendance.\");\r\n      }\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"qr-scanner-container\">\r\n      <div className=\"qr-scanner-header\">\r\n        <h2>Mark Attendance</h2>\r\n        \r\n        {/* Mode Toggle */}\r\n        <div style={{\r\n          display: 'flex',\r\n          gap: '10px',\r\n          marginBottom: '20px',\r\n          justifyContent: 'center'\r\n        }}>\r\n          <button\r\n            onClick={() => {\r\n              setScanMode('camera');\r\n              setError(null);\r\n              setManualToken('');\r\n              if (!cameraRunningRef.current) {\r\n                setIsRetrying(prev => !prev);\r\n              }\r\n            }}\r\n            style={{\r\n              padding: '10px 20px',\r\n              backgroundColor: scanMode === 'camera' ? '#4CAF50' : '#e0e0e0',\r\n              color: scanMode === 'camera' ? 'white' : '#333',\r\n              border: 'none',\r\n              borderRadius: '5px',\r\n              cursor: 'pointer',\r\n              fontSize: '14px',\r\n              fontWeight: scanMode === 'camera' ? 'bold' : 'normal'\r\n            }}\r\n          >\r\n            ðŸ“· Scan QR Code\r\n          </button>\r\n          <button\r\n            onClick={async () => {\r\n              setScanMode('manual');\r\n              setError(null);\r\n              await stopCameraSafely();\r\n            }}\r\n            style={{\r\n              padding: '10px 20px',\r\n              backgroundColor: scanMode === 'manual' ? '#4CAF50' : '#e0e0e0',\r\n              color: scanMode === 'manual' ? 'white' : '#333',\r\n              border: 'none',\r\n              borderRadius: '5px',\r\n              cursor: 'pointer',\r\n              fontSize: '14px',\r\n              fontWeight: scanMode === 'manual' ? 'bold' : 'normal'\r\n            }}\r\n          >\r\n            âŒ¨ï¸ Enter Token\r\n          </button>\r\n        </div>\r\n\r\n        <div style={{\r\n          backgroundColor: '#e3f2fd',\r\n          border: '1px solid #2196F3',\r\n          borderRadius: '8px',\r\n          padding: '12px',\r\n          marginBottom: '15px',\r\n          fontSize: '13px',\r\n          color: '#1565c0'\r\n        }}>\r\n          <strong>âš ï¸ Important:</strong> You must be physically present in the classroom to mark attendance. \r\n          GPS location verification is required. Remote attendance is blocked.\r\n        </div>\r\n\r\n        {scanMode === 'camera' ? (\r\n          <div>\r\n            <p style={{ marginBottom: '10px' }}>\r\n              Point your camera at the QR code displayed in class. Your location and device information will be verified.\r\n            </p>\r\n            {!isScanning && !error && (\r\n              <div style={{\r\n                backgroundColor: '#fff3cd',\r\n                border: '1px solid #ffc107',\r\n                borderRadius: '8px',\r\n                padding: '12px',\r\n                marginBottom: '15px',\r\n                fontSize: '13px',\r\n                color: '#856404'\r\n              }}>\r\n                <strong>ðŸ“· Camera Permission:</strong> Your browser will ask for camera permission. Please click <strong>\"Allow\"</strong> to enable QR code scanning.\r\n              </div>\r\n            )}\r\n            {availableCameras.length > 1 && (\r\n              <button\r\n                onClick={handleSwitchCamera}\r\n                disabled={isSwitchingCamera}\r\n                style={{\r\n                  padding: '8px 16px',\r\n                  backgroundColor: isSwitchingCamera ? '#ccc' : '#2196F3',\r\n                  color: 'white',\r\n                  border: 'none',\r\n                  borderRadius: '5px',\r\n                  cursor: isSwitchingCamera ? 'not-allowed' : 'pointer',\r\n                  fontSize: '14px',\r\n                  marginTop: '10px'\r\n                }}\r\n              >\r\n                {isSwitchingCamera ? 'ðŸ”„ Switching...' : 'ðŸ”„ Switch Camera'}\r\n              </button>\r\n            )}\r\n            {availableCameras.length > 0 && (\r\n              <p style={{ \r\n                fontSize: '12px', \r\n                color: '#666', \r\n                marginTop: '8px',\r\n                fontStyle: 'italic'\r\n              }}>\r\n                Using: {availableCameras[currentCameraIndex]?.label || 'Camera ' + (currentCameraIndex + 1)}\r\n              </p>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            <p style={{ marginBottom: '15px' }}>\r\n              Enter the token shown by your teacher on the projector screen.\r\n            </p>\r\n            <div style={{\r\n              display: 'flex',\r\n              flexDirection: 'column',\r\n              gap: '10px',\r\n              maxWidth: '400px',\r\n              margin: '0 auto'\r\n            }}>\r\n              <input\r\n                type=\"text\"\r\n                value={manualToken}\r\n                onChange={(e) => setManualToken(e.target.value)}\r\n                placeholder=\"Enter token here (e.g., CLASS-123-4567890)\"\r\n                style={{\r\n                  padding: '12px',\r\n                  fontSize: '16px',\r\n                  border: '2px solid #ddd',\r\n                  borderRadius: '5px',\r\n                  textAlign: 'center'\r\n                }}\r\n                onKeyPress={(e) => {\r\n                  if (e.key === 'Enter') {\r\n                    handleManualSubmit();\r\n                  }\r\n                }}\r\n              />\r\n              <button\r\n                onClick={handleManualSubmit}\r\n                style={{\r\n                  padding: '12px 24px',\r\n                  backgroundColor: '#4CAF50',\r\n                  color: 'white',\r\n                  border: 'none',\r\n                  borderRadius: '5px',\r\n                  cursor: 'pointer',\r\n                  fontSize: '16px',\r\n                  fontWeight: 'bold'\r\n                }}\r\n              >\r\n                Submit Token\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {scanMode === 'camera' && !isScanning && !error && (\r\n        <div style={{\r\n          backgroundColor: '#e3f2fd',\r\n          border: '1px solid #90caf9',\r\n          borderRadius: '8px',\r\n          padding: '15px',\r\n          margin: '15px 0',\r\n          color: '#1565c0',\r\n          textAlign: 'center'\r\n        }}>\r\n          Initializing camera...\r\n        </div>\r\n      )}\r\n\r\n      {error && (\r\n        <div style={{\r\n          backgroundColor: '#fee',\r\n          border: '1px solid #fcc',\r\n          borderRadius: '8px',\r\n          padding: '15px',\r\n          margin: '15px 0',\r\n          color: '#c33'\r\n        }}>\r\n          <strong>Error:</strong> {error}\r\n          <div style={{ marginTop: '10px' }}>\r\n            <button \r\n              onClick={handleRetry}\r\n              style={{\r\n                padding: '8px 16px',\r\n                backgroundColor: '#4CAF50',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: '4px',\r\n                cursor: 'pointer',\r\n                fontSize: '14px',\r\n                marginRight: '10px'\r\n              }}\r\n            >\r\n              Retry Camera\r\n            </button>\r\n            <button \r\n              onClick={() => window.location.reload()}\r\n              style={{\r\n                padding: '8px 16px',\r\n                backgroundColor: '#2196F3',\r\n                color: 'white',\r\n                border: 'none',\r\n                borderRadius: '4px',\r\n                cursor: 'pointer',\r\n                fontSize: '14px'\r\n              }}\r\n            >\r\n              Refresh Page\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {scanMode === 'camera' && (\r\n        <div className=\"qr-reader-wrapper\">\r\n          <div id=\"reader\"></div>\r\n        </div>\r\n      )}\r\n      \r\n      {scanMode === 'manual' && (\r\n        <div style={{\r\n          textAlign: 'center',\r\n          padding: '20px',\r\n          backgroundColor: '#f5f5f5',\r\n          borderRadius: '8px',\r\n          marginTop: '20px'\r\n        }}>\r\n          <p style={{ color: '#666', fontSize: '14px' }}>\r\n            ðŸ’¡ <strong>Tip:</strong> Look at the projector screen for the token text below the QR code.\r\n            Type it exactly as shown (including dashes and numbers).\r\n          </p>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}